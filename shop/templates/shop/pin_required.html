{% extends "shop/base.html" %}
{% block content %}
<div class="container mt-5" style="max-width:420px;">

  <h2 class="text-center mb-2">PIN erforderlich</h2>
  <p class="text-center text-muted">{{ user.display_name }}</p>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-danger text-center fw-bold">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <form method="post" id="pin-form">{% csrf_token %}
    <input type="hidden" name="action" value="check_pin">

    <input type="password"
           id="pin-input"
           name="pin"
           class="form-control form-control-lg text-center mb-3"
           placeholder="PIN eingeben"
           inputmode="numeric"
           pattern="[0-9]*"
           maxlength="8"
           required>

    <div class="row g-2 text-center">
      {% for n in "123456789" %}
      <div class="col-4">
        <button type="button" class="btn btn-outline-primary btn-lg w-100"
                onclick="addDigit('{{ n }}')">
          {{ n }}
        </button>
      </div>
      {% endfor %}

      <div class="col-4">
        <button type="button" class="btn btn-outline-danger btn-lg w-100"
                onclick="clearPin()">✖</button>
      </div>

      <div class="col-4">
        <button type="button" class="btn btn-outline-primary btn-lg w-100"
                onclick="addDigit('0')">0</button>
      </div>

      <div class="col-4">
        <button type="button" class="btn btn-outline-secondary btn-lg w-100"
                onclick="removeDigit()">⌫</button>
      </div>
    </div>

    <button class="btn btn-primary btn-lg w-100 mt-4">
      Bestätigen
    </button>
  </form>
</div>

<script>
  const pinInput = document.getElementById('pin-input');

  function addDigit(d) {
    if (pinInput.value.length < pinInput.maxLength) {
      pinInput.value += d;
    }
  }

  function removeDigit() {
    pinInput.value = pinInput.value.slice(0, -1);
  }

  function clearPin() {
    pinInput.value = '';
  }

  document.getElementById('pin-input').focus();
</script>
{% endblock %}
