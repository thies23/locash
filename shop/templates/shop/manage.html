{% extends 'shop/base.html' %}
{% block content %}
  <div class="row">
    <div class="col-md-4">
      <h3>App Settings</h3>
      <form method="post">{% csrf_token %}
        <input type="hidden" name="update_app_settings" value="1">
        <div class="form-check form-switch mb-3">
          <label class="form-check-label" for="show_manage_menu">Management Menü anzeigen</label>
          <input class="form-check-input" type="checkbox" id="show_manage_menu" name="show_manage_menu"
                 {% if app_settings.show_manage_menu %}checked{% endif %}>
        </div>
        <div class="form-check form-switch mb-3">
          <label class="form-check-label" for="show_balance_in_user_list">Guthaben in Benutzerliste anzeigen</label>
          <input class="form-check-input" type="checkbox" id="show_balance_in_user_list" name="show_balance_in_user_list"
                 {% if app_settings.show_balance_in_user_list %}checked{% endif %}>
        </div>
        <button class="btn btn-primary">Speichern</button>
      </form>

      <hr>

      <h3>Magic IDs</h3>
      <form method="post" enctype="multipart/form-data">{% csrf_token %}
        <input type="hidden" name="create_magic_id" value="1">
        <div class="input-group">
          {{ create_magicid_form.id12 }}
          {{ create_magicid_form.target }}
          <input type="hidden" name="action" value="create_magic_id">
          <button class="btn btn-primary">Anlegen</button>
        </div>
      </form>

      <h4 class="mt-4">Bestehende Magic IDs</h4>
      <table class="table">
        <thead><tr><th>ID12</th><th>Ziel</th></tr></thead>
        <tbody>
          {% for m in magic_ids %}
            <tr>
              <td>{{ m.id12 }}</td>
              <td>{{ m.target }}</td>
              <td>
                <form method="post" style="display:inline;">{% csrf_token %}
                  <input type="hidden" name="delete_magic_id" value="1">
                  <input type="hidden" name="magic_id_pk" value="{{ m.pk }}">
                  <button class="btn btn-sm btn-danger">Löschen</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="col-md-4">
      <h3>Neue Benutzer anlegen</h3>
      <form method="post">{% csrf_token %}
        <input type="hidden" name="create_user" value="1">
        <div class="input-group mb-3">
          {{ create_user_form.username }}
          {{ create_user_form.display_name }}
        </div>
        <div class="input-group mb-3">
            {{ create_user_form.id12 }}
            <button type="button" class="btn btn-secondary" onclick="generateID('id_id12')">Generieren</button>
        </div>
        <div class="input-group  mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="">Startguthaben</span>
          </div>
          {{ create_user_form.balance }}
        </div>
        <button class="btn btn-primary">Erstellen</button>
      </form>

      <h4 class="mt-4">Bestehende Benutzer</h4>
      <table class="table">
        <thead><tr><th>Username</th><th>Anzeigename</th><th>ID</th><th>Guthaben</th></tr></thead>
        <tbody>
          {% for u in users %}
            <tr>
              <td><a href="{% url 'user_detail' u.id12 %}">{{ u.username }}</a></td>
              <td>{{ u.display_name }}</td>
              <td>{{ u.id12 }}</td>
              <td>{{ u.balance }}€</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="col-md-4">
      <h3>Produkte</h3>
      <form method="post" enctype="multipart/form-data">{% csrf_token %}
        <div class="input-group">
          <input type="hidden" name="create_product" value="1">
          <!-- {{ create_product_form.as_p }} -->

          {{ create_product_form.name }}
          {{ create_product_form.id12 }}
          {{ create_product_form.price }}
          <button class="btn btn-primary">Anlegen</button>
        </div>
      </form>

      <h4 class="mt-4">Bestehende Produkte</h4>
      <table class="table">
        <thead><tr><th>Name</th><th>ID</th><th>Preis</th><th>Neuer Preis</th></tr></thead>
        <tbody>
          {% for p in products %}
            <tr>
              <td>{{ p.name }}</td>
              <td>{{ p.id12 }}</td>
              <td>{{ p.price }}€</td>
              <td>
                <form method="post" style="display:inline;">{% csrf_token %}
                  <input type="hidden" name="edit_price" value="1">
                  <input type="hidden" name="product_pk" value="{{ p.pk }}">
                  <input name="price" value="{{ p.price }}" class="form-control" style="width:120px;display:inline;">
                  <button class="btn btn-sm btn-secondary">Speichern</button>
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <script>
    function generateID(elementId) {
        fetch("{% url 'generate_unique_id' %}")
            .then(response => response.json())
            .then(data => {
                document.getElementById(elementId).value = data.id;
            });
    }
  </script>

{% endblock %}
